<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Coming Soon</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: 'Press Start 2P', cursive;
  background: white;
  overflow: hidden;
  touch-action: none;
}

/* COOKIE SIZE CONTROLLER */
.stage {
  position: relative;
  width: 350px;
  height: 350px;
}

.cookie {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.hidden {
  opacity: 0;
  visibility: hidden;
}

#three-container {
  position: fixed;
  inset: 0;
  z-index: 10;
  opacity: 0;
  display: flex;
  visibility: hidden;
  justify-content: center;
  align-items: center;
  pointer-events: none;
}
#three-container.active { visibility: visible; }
#three-container.interactive { pointer-events: auto; }

#click-hint {
  position: absolute;
  bottom: -50px;
  width: 100%;
  text-align: center;
  font-size: 20px;
  color: #f4a261;
  animation: pulse 1.2s infinite ease-in-out;
}

@keyframes pulse {
  0% { transform: scale(1); opacity: 0.7; }
  50% { transform: scale(1.05); opacity: 1; }
  100% { transform: scale(1); opacity: 0.7; }
}

canvas.webgl {
  width: 100%;
  height: 100%;
  display: block;
}

@media (max-width: 768px) {
  .stage {
    width: 70vmin;
    height: 70vmin;
  }
}
</style>
</head>

<body>

<div class="stage" id="stage">
  <img src="./images/cookie_whole.png" class="cookie whole" />
  <img src="./images/cookie_crack.png" class="cookie crack hidden" />
  <img src="./images/cookie_left.png" class="cookie piece left hidden" />
  <img src="./images/cookie_right.png" class="cookie piece right hidden" />
  <div id="click-hint">Tap Me!</div>
</div>

<div id="three-container" class="hidden">
  <canvas class="webgl"></canvas>
</div>

<audio id="snd-click" src="./sounds/click.mp3" preload="auto"></audio>
<audio id="snd-crack" src="./sounds/crack.mp3" preload="auto"></audio>
<audio id="snd-woosh" src="./sounds/woosh.mp3" preload="auto"></audio>

<script type="module">
import * as THREE from 'https://unpkg.com/three@0.158.0/build/three.module.js'
import { FontLoader } from 'https://unpkg.com/three@0.158.0/examples/jsm/loaders/FontLoader.js'
import { TextGeometry } from 'https://unpkg.com/three@0.158.0/examples/jsm/geometries/TextGeometry.js'

window.addEventListener('load', () => {

const sndClick = document.getElementById('snd-click');
const sndCrack = document.getElementById('snd-crack');
const sndWoosh = document.getElementById('snd-woosh');

function play(sound) {
  sound.currentTime = 0;
  sound.play().catch(()=>{});
}

const whole = document.querySelector('.whole');
const crack = document.querySelector('.crack');
const left = document.querySelector('.left');
const right = document.querySelector('.right');
const threeContainer = document.getElementById('three-container');
const clickHint = document.getElementById('click-hint');

let click = 0;
let textInteractive = false;

function handleTap() {
  click++;

  if (click === 1) play(sndClick);

  if (click === 2) {
    play(sndCrack);
    whole.classList.add('hidden');
    crack.classList.remove('hidden');
  }

  if (click === 3) {
    play(sndClick);
    gsap.fromTo(crack, { rotation: -2 }, { rotation: 2, yoyo: true, repeat: 3, duration: 0.08 });
  }

  if (click === 4) {
    crack.classList.add('hidden');
    left.classList.remove('hidden');
    right.classList.remove('hidden');
    clickHint.style.display = "none";

    gsap.to(left, { x: -230, duration: 1 });
    gsap.to(right, { x: 230, duration: 1 });

    threeContainer.classList.remove('hidden');
    initThreeText();

    gsap.to(threeContainer, { opacity: 1, duration: 0.4 });
    threeContainer.classList.add('active');
  }

  if (click === 5) {
    play(sndWoosh);
    gsap.to([left, right], {
      opacity: 0,
      y: 120,
      duration: 0.6,
      onComplete: () => {
        left.remove();
        right.remove();
      }
    });

    textInteractive = true;
    threeContainer.classList.add('interactive');
  }
}

window.addEventListener('click', handleTap);
window.addEventListener('touchstart', handleTap);

/* ================= THREE ================= */

let threeStarted = false;

function initThreeText() {
  if (threeStarted) return;
  threeStarted = true;

  const canvas = document.querySelector('canvas.webgl');

  const scene = new THREE.Scene();

  const camera = new THREE.PerspectiveCamera(65, window.innerWidth / window.innerHeight, 0.1, 100);
  camera.position.set(0, 0, 10);
  scene.add(camera);

  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });

  scene.add(new THREE.AmbientLight(0xffffff, 1));

  const loader = new FontLoader();
  loader.load('./fonts/Press Start 2P_Regular.json', (font) => {

    const group = new THREE.Group();
    scene.add(group);

    const material = new THREE.MeshBasicMaterial({ color: 0xed820e });

    const comingGeo = new TextGeometry('COMING', { font, size: 1.2, height: 0.25 });
    comingGeo.center();
    const comingMesh = new THREE.Mesh(comingGeo, material);
    group.add(comingMesh);

    const soonGeo = new TextGeometry('SOON', { font, size: 1.2, height: 0.25 });
    soonGeo.center();
    const soonMesh = new THREE.Mesh(soonGeo, material);
    group.add(soonMesh);

    comingMesh.position.y = 1.2;
    soonMesh.position.y = -1.2;

    group.scale.set(0.48, 0.48, 0.48);

    /* ROTATION DESKTOP */
    window.addEventListener('mousemove', (e) => {
      if (!textInteractive) return;
      const x = (e.clientX / window.innerWidth) * 2 - 1;
      const y = (e.clientY / window.innerHeight) * 2 - 1;

      gsap.to(group.rotation, {
        y: x * 1.2,
        x: -y * 0.8,
        duration: 0.8
      });
    });

    /* ROTATION MOBILE */
    window.addEventListener('touchmove', (e) => {
      if (!textInteractive) return;
      const t = e.touches[0];

      const x = (t.clientX / window.innerWidth) * 2 - 1;
      const y = (t.clientY / window.innerHeight) * 2 - 1;

      gsap.to(group.rotation, {
        y: x * 1.2,
        x: -y * 0.8,
        duration: 0.8
      });
    });

  });

  function animate() {
    renderer.render(scene, camera);
    requestAnimationFrame(animate);
  }

  animate();
}

});
</script>

</body>
</html>
